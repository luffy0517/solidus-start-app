<% filters = applicable_filters_for(@taxon) %>

<% unless filters.empty? %>
  <%= form_tag '', method: :get, id: 'sidebar_products_search' do %>
    <%= hidden_field_tag 'per_page', params[:per_page] %>

    <% filters.each do |filter| %>
      <% labels = filter[:labels] || filter[:conds].map {|m,c| [m,m]} %>

      <% next if labels.empty? %>
      <h6><%= filter[:name] %></h6>
      <ul>
        <% labels.each do |nm,val| %>
          <%
            label = "#{filter[:name]}_#{nm}".gsub(/\s+/,'_')
            checked = params[:search] &&
              params[:search][filter[:scope]] &&
              params[:search][filter[:scope]].include?(val.to_s) ? "checked" : ""
          %>
          <li>
            <input
              type="checkbox"
              id="<%= label %>"
              name="search[<%= filter[:scope].to_s %>][]"
              value="<%= val %>"
              <%= checked %>
            />
            <label for="<%= label %>">
              <%= nm %>
            </label>
          </li>
        <% end %>
      </ul>
    <% end %>

    <%= submit_tag t('spree.search'), name: nil %>
  <% end %>
<% end %>
