<%
  url = spree.product_path(product, taxon_id: @taxon.try(:id))
  cached = @taxon.present? ?
    [I18n.locale, current_pricing_options, @taxon, product] :
    [I18n.locale, current_pricing_options, product]
%>

<li data-hook="products_list_item" itemscope itemtype="http://schema.org/Product">
  <% cache cached do %>
    <article>
      <section class="product-image">
        <%= link_to render('spree/shared/image', image: product.gallery.images.first, size: :small, itemprop: "image"), url, itemprop: 'url' %>
      </section>
      <header>
        <h2>
          <%= link_to truncate(product.name, length: 50), url, class: 'info', itemprop: "name", title: product.name %>
        </h2>
      </header>
      <section itemprop="offers" itemscope itemtype="http://schema.org/Offer">
        <% if price = product.price_for(current_pricing_options) %>
          <span class="price selling" itemprop="price" content="<%= price.to_d %>">
            <%= price.to_html %>
          </span>
        <% end %>
        <span itemprop="priceCurrency" content="<%= current_pricing_options.currency %>"></span>
      </section>
    </article>
  <% end %>
</li>
